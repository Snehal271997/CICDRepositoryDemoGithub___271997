
image:
  name: salesforce/cli:latest-slim

pipelines:
  default:
    - step:
        script:
          - echo "Commited changes to a branch that does not match the listed branches in bitbucket-pipelines.yml."
          - echo "You can skip running pipeline by adding [skip ci] or [ci skip] (with []) to the git commit message."
          - sf --version
          - sf plugins --core
          branches:
                   
    TEST ORG VALIDATION:
     - step:
         script:
           - sf --version
           - sf force:auth:jwt:grant -f server.key -i $SFDC_CONSUMER_KEY -u $SFDC_USER -d -s -r $SFDC_URL
           - sf scanner run --format=junit --target "**/src/**" 
           - sf force:mdapi:deploy -d src -w 60 -l RunLocalTests -u $SFDC_USER
       

     
    TEST ORG:
     - step:
         script:
           - sf --version
           - sf force:auth:jwt:grant -f server.key -i $SFDC_CONSUMER_KEY -u $SFDC_USER -d -s -r $SFDC_URL
           - sf force:mdapi:deploy -d src -w 60 -l NoTestRun -u $SFDC_USER
           
          
